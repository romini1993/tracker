<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Chain Tracker - Bro Minas</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#050505] text-slate-200 min-h-screen p-4 md:p-10 font-sans">

    <div class="max-w-4xl mx-auto">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-black text-white italic tracking-tighter">MINAS MULTI-SCAN</h1>
            <button id="btnCopy" onclick="copyData()" class="hidden bg-emerald-600 hover:bg-emerald-500 text-white px-6 py-2 rounded-full font-bold text-xs transition-all shadow-lg shadow-emerald-900/20">
                ðŸ“‹ COPY SEMUA DATA
            </button>
        </div>

        <div class="bg-[#111] p-6 rounded-2xl border border-white/5 mb-6 shadow-2xl">
            <div class="flex flex-col md:flex-row gap-3">
                <input id="addr" type="text" placeholder="Paste Address EVM (0x...)" 
                    class="flex-1 bg-[#1a1a1a] border border-white/10 p-4 rounded-xl focus:outline-none focus:border-blue-500 text-white font-mono">
                <button onclick="scanSemuaNetwork()" class="bg-blue-600 text-white hover:bg-blue-500 px-8 py-4 rounded-xl font-black transition-all transform active:scale-95">
                    SCAN SEMUA
                </button>
            </div>
        </div>

        <div id="loader" class="hidden text-center py-10">
            <div class="animate-spin rounded-full h-10 w-10 border-t-2 border-blue-500 mx-auto mb-4"></div>
            <p id="loadingText" class="text-blue-400 font-bold animate-pulse text-sm">Scanning networks...</p>
        </div>

        <div class="bg-[#111] rounded-2xl border border-white/5 overflow-hidden shadow-2xl">
            <table class="w-full text-left border-collapse">
                <thead class="bg-white/5 text-[10px] uppercase font-bold text-slate-500 tracking-widest">
                    <tr>
                        <th class="p-4">Network</th>
                        <th class="p-4">Token</th>
                        <th class="p-4 text-right">Balance</th>
                        <th class="p-4">Contract</th>
                    </tr>
                </thead>
                <tbody id="hasil">
                    <tr><td colspan="4" class="p-16 text-center text-slate-700 italic">Belum ada data.</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let koinData = [];

        async function scanSemuaNetwork() {
            const address = document.getElementById('addr').value.trim();
            const tableBody = document.getElementById('hasil');
            const loader = document.getElementById('loader');
            const btnCopy = document.getElementById('btnCopy');
            const loadingText = document.getElementById('loadingText');

            if (!address.startsWith('0x') || address.length < 42) return alert('Address salah, Bro!');

            tableBody.innerHTML = '';
            loader.classList.remove('hidden');
            btnCopy.classList.add('hidden');
            koinData = [];

            // List Jaringan Request Elu
            const networks = [
                { id: 'eth', name: 'Ethereum', api: `https://api.ethplorer.io/getAddressInfo/${address}?apiKey=freekey` },
                { id: 'bsc', name: 'BSC', api: `https://api.allorigins.win/get?url=${encodeURIComponent(`https://api.bscscan.com/api?module=account&action=balance&address=${address}`)}` },
                { id: 'polygon', name: 'Polygon', api: `https://api.allorigins.win/get?url=${encodeURIComponent(`https://api.polygonscan.com/api?module=account&action=balance&address=${address}`)}` }
            ];

            // 1. Tarik Data Ethereum (Paling Stabil)
            try {
                loadingText.innerText = "Scanning Ethereum...";
                const resEth = await fetch(networks[0].api);
                const dataEth = await resEth.json();
                
                if (dataEth.ETH) tambahKoin('ETH', 'Ethereum', dataEth.ETH.balance, 'Native');
                if (dataEth.tokens) {
                    dataEth.tokens.forEach(t => {
                        const bal = t.balance / Math.pow(10, t.tokenInfo.decimals);
                        if (bal > 0) tambahKoin(t.tokenInfo.symbol, 'Ethereum', bal, t.tokenInfo.address);
                    });
                }
            } catch (e) { console.error("ETH Error"); }

            // 2. Tarik Data Multi-Chain via Ankr (Ditingkatkan)
            try {
                loadingText.innerText = "Scanning L2 & Other Chains (Base, Manta, ZkSync, etc)...";
                const response = await fetch('https://rpc.ankr.com/multichain', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        jsonrpc: "2.0",
                        method: "ankr_getAccountBalance",
                        params: { 
                            walletAddress: address,
                            blockchain: ["eth", "bsc", "polygon", "arbitrum", "optimism", "avalanche", "base", "manta", "mantle", "zksync"] 
                        },
                        id: 1
                    })
                });
                const resMultichain = await response.json();
                if (resMultichain.result && resMultichain.result.assets) {
                    resMultichain.result.assets.forEach(asset => {
                        if (asset.blockchain !== 'eth') { // Hindari duplikat ETH
                            tambahKoin(asset.tokenSymbol, asset.blockchain.toUpperCase(), asset.balance, asset.tokenAddress);
                        }
                    });
                }
            } catch (e) { console.error("Multichain Error"); }

            loader.classList.add('hidden');
            if (koinData.length > 0) {
                btnCopy.classList.remove('hidden');
                renderTable();
            } else {
                tableBody.innerHTML = '<tr><td colspan="4" class="p-16 text-center text-slate-600">Gak nemu koin di network lain, Bro.</td></tr>';
            }
        }

        function tambahKoin(sym, net, bal, ca) {
            // Cek biar gak duplikat
            const isExist = koinData.find(k => k.symbol === sym && k.network === net);
            if (!isExist && parseFloat(bal) > 0) {
                koinData.push({ symbol: sym, network: net, balance: bal, contract: ca });
            }
        }

        function renderTable() {
            const tableBody = document.getElementById('hasil');
            tableBody.innerHTML = koinData.map(k => `
                <tr class="border-t border-white/5 hover:bg-white/5">
                    <td class="p-4 text-xs font-bold text-blue-400">${k.network}</td>
                    <td class="p-4 font-black text-white">${k.symbol}</td>
                    <td class="p-4 text-right font-mono text-emerald-400 font-bold">${parseFloat(k.balance).toFixed(4)}</td>
                    <td class="p-4 text-[10px] text-slate-600 font-mono">${k.contract === '0x0000000000000000000000000000000000000000' ? 'NATIVE' : k.contract}</td>
                </tr>
            `).join('');
        }

        function copyData() {
            let txt = "NETWORK | TOKEN | BALANCE | CA\n";
            koinData.forEach(k => {
                txt += `${k.network} | ${k.symbol} | ${k.balance} | ${k.contract}\n`;
            });
            navigator.clipboard.writeText(txt);
            alert('Semua data berhasil di-copy ke clipboard!');
        }
    </script>
</body>
</html>
